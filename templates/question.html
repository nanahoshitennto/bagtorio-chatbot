{% extends "base.html" %}

{% block content %}
<div class="chat-box" id="chat-container">

    <!-- 最初の質問 -->
    <div class="question-box show" id="q{{ question[0] }}">
        <div class="chat-header">
            <img src="{{ url_for('static', filename='reset-icon.png') }}" alt="チャット君">
            <div class="question-text">{{ question[1] }}</div>
        </div>
        <div class="options-grid">
            {% for option in options %}
                {% if option[1] and option[1] != 'None' %}
                    <a onclick="showNextQuestion('q{{ option[1] }}')">{{ option[0] }}</a>
                {% else %}
                    <a onclick="showNextQuestion('qend')">{{ option[0] }}</a>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- 2問目以降 -->
    {% for q in all_questions %}
    <div class="question-box" id="q{{ q.id }}">
        <div class="chat-header">
            <img src="{{ url_for('static', filename='reset-icon.png') }}" alt="チャット君">
            <div class="question-text">{{ q.question }}</div>
        </div>
        <div class="options-grid">
            {% for opt in q.options %}
                {% if opt.next_id and opt.next_id != 'None' %}
                    <a onclick="showNextQuestion('q{{ opt.next_id }}')">{{ opt.text }}</a>
                {% else %}
                    <a onclick="showNextQuestion('qend')">{{ opt.text }}</a>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endfor %}

    <!-- 終了メッセージ -->
    <div class="question-box" id="qend">
        <div class="end-message">ご回答ありがとうございました！</div>
    </div>

</div>

<script>
    function showNextQuestion(nextId) {
        if (!nextId || nextId === 'qNone' || nextId === 'None') {
            nextId = 'qend';
        }
        const nextBox = document.getElementById(nextId);
        if (nextBox) {
            nextBox.classList.add('show');
            nextBox.scrollIntoView({ behavior: 'smooth' });
        }
    }
</script>
{% endblock %}
